<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum" vellum:ignore="richText">
    <h:head>
        <h:title>Date Calculator [en] </h:title>
        <model>
            <instance>
                <data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/eba429e5f98c75a45168b4e06ae21b9a0c38ba30" uiVersion="1" version="323" name="Date Calculator [en] ">
                    <date/>
                    <date_eth/>
                    <report_month/>
                    <report_week/>
                    <display/>
                    <archive>
                        <date_eth_old/>
                        <report_week_old/>
                    </archive>
                    <orx:meta xmlns:cc="http://commcarehq.org/xforms"><orx:deviceID/><orx:timeStart/><orx:timeEnd/><orx:username/><orx:userID/><orx:instanceID/><cc:appVersion/></orx:meta></data>
            </instance><instance id="commcaresession" src="jr://instance/session"/>
            <bind nodeset="/data/date" type="xsd:date"/>
            <bind nodeset="/data/date_eth" relevant="/data/date != &quot;&quot;" calculate="format-date-for-calendar(date(/data/date), 'ethiopian', &quot;%Y-%m-%d&quot;)"/>
            <bind nodeset="/data/report_month" relevant="/data/date != &quot;&quot;" calculate="concat(substr(/data/date_eth, 0, 4) - if(substr(/data/date_eth, 5, 7) = 1 and substr(/data/date_eth, 8, 10) &lt; 21, 1, 0), if(if(substr(/data/date_eth, 8, 10) &gt;= 21, substr(/data/date_eth, 5, 7), if(substr(/data/date_eth, 5, 7) = 1, 12, substr(/data/date_eth, 5, 7) - 1)) &lt; 10, '-0', '-'), int(if(substr(/data/date_eth, 8, 10) &gt;= 21, substr(/data/date_eth, 5, 7), if(substr(/data/date_eth, 5, 7) = 1, 12, substr(/data/date_eth, 5, 7) - 1))), '-21')"/>
            <bind nodeset="/data/report_week" relevant="/data/date != &quot;&quot;" calculate="format-date-for-calendar(date(/data/date) - (format-date(date(/data/date), &quot;%w&quot;) + 2) mod 7, 'ethiopian', &quot;%Y-%m-%d&quot;)"/>
            <bind nodeset="/data/display"/>
            <bind nodeset="/data/archive"/>
            <bind nodeset="/data/archive/date_eth_old" calculate="if(/data/date = &quot;&quot;, &quot;&quot;, concat(int((date(/data/date) - 253) div 365.25) + 1963, if(int((date(/data/date) - 253 - (365 * int((date(/data/date) - 253) div 365.25) + 1 + int((int((date(/data/date) - 253) div 365.25) - 1) div 4))) div 30) + 1 &lt; 10, &quot;-0&quot;, &quot;-&quot;), int((date(/data/date) - 253 - (365 * int((date(/data/date) - 253) div 365.25) + 1 + int((int((date(/data/date) - 253) div 365.25) - 1) div 4))) div 30) + 1, if(((date(/data/date) - 253 - (365 * int((date(/data/date) - 253) div 365.25) + 1 + int((int((date(/data/date) - 253) div 365.25) - 1) div 4))) mod 30) + 1 &lt; 10, &quot;-0&quot;, &quot;-&quot;), ((date(/data/date) - 253 - (365 * int((date(/data/date) - 253) div 365.25) + 1 + int((int((date(/data/date) - 253) div 365.25) - 1) div 4))) mod 30) + 1))"/>
            <bind nodeset="/data/archive/report_week_old" calculate="if(/data/date = &quot;&quot;, &quot;&quot;, concat(int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253) div 365.25) + 1963, if(int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253 - (365 * int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253) div 365.25) + 1 + int((int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253) div 365.25) - 1) div 4))) div 30) + 1 &lt; 10, &quot;-0&quot;, &quot;-&quot;), int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253 - (365 * int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253) div 365.25) + 1 + int((int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253) div 365.25) - 1) div 4))) div 30) + 1, if(((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253 - (365 * int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253) div 365.25) + 1 + int((int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253) div 365.25) - 1) div 4))) mod 30) + 1 &lt; 10, &quot;-0&quot;, &quot;-&quot;), ((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253 - (365 * int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253) div 365.25) + 1 + int((int((date(date(/data/date) - replace(replace(replace(replace(replace(replace(replace(format-date(date(/data/date), &quot;%a&quot;), &quot;Fri&quot;, 0), &quot;Sat&quot;, 1), &quot;Sun&quot;, 2), &quot;Mon&quot;, 3), &quot;Tue&quot;, 4), &quot;Wed&quot;, 5), &quot;Thu&quot;, 6)) - 253) div 365.25) - 1) div 4))) mod 30) + 1))"/>
            <itext>
                <translation lang="amh" default="">
                    <text id="date-label">
                        <value>Pick a date (please)</value>
                    </text>
                    <text id="display-label">
                        <value>Gregorian Date: <output value="/data/date"/>

                            Ethiopian Date: <output value="/data/archive/date_eth_old"/>

                            Ethiopian Date new: <output value="/data/date_eth"/>

                            Reporting month: <output value="/data/report_month"/>

                            Reporting week: <output value="/data/archive/report_week_old"/>

                            Reporting week new: <output value="/data/report_week"/></value>
                    </text>
                </translation>
                <translation lang="en">
                    <text id="date-label">
                        <value>Pick a date</value>
                    </text>
                    <text id="display-label">
                        <value>Gregorian Date: <output value="/data/date"/>

                            Ethiopian Date: <output value="/data/archive/date_eth_old"/>

                            Ethiopian Date new: <output value="/data/date_eth"/>

                            Reporting month: <output value="/data/report_month"/>

                            Reporting week: <output value="/data/archive/report_week_old"/>

                            Reporting week new: <output value="/data/report_week"/></value>
                    </text>
                </translation>
            </itext>
            <setvalue event="xforms-ready" ref="/data/meta/deviceID" value="instance('commcaresession')/session/context/deviceid"/><setvalue event="xforms-ready" ref="/data/meta/timeStart" value="now()"/><bind nodeset="/data/meta/timeStart" type="xsd:dateTime"/><setvalue event="xforms-revalidate" ref="/data/meta/timeEnd" value="now()"/><bind nodeset="/data/meta/timeEnd" type="xsd:dateTime"/><setvalue event="xforms-ready" ref="/data/meta/username" value="instance('commcaresession')/session/context/username"/><setvalue event="xforms-ready" ref="/data/meta/userID" value="instance('commcaresession')/session/context/userid"/><setvalue event="xforms-ready" ref="/data/meta/instanceID" value="uuid()"/><setvalue event="xforms-ready" ref="/data/meta/appVersion" value="instance('commcaresession')/session/context/appversion"/></model>
    </h:head>
    <h:body>
        <input ref="/data/date" appearance="ethiopian">
            <label ref="jr:itext('date-label')"/>
        </input>
        <trigger ref="/data/display" appearance="minimal">
            <label ref="jr:itext('display-label')"/>
        </trigger>
        <group ref="/data/archive"/>
    </h:body>
</h:html>